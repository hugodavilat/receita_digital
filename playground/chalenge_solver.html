<!--
Documentation:
- https://github.com/dchest/tweetnacl-js#public-key-authenticated-encryption-box
- https://github.com/dchest/tweetnacl-js/wiki/Examples
-->
<html>
<head>
    <script src="nacl.min.js"></script>
</head>
<body>
    <h1>Challenge Solver</h1>
    <a>Challenge:</a><input type="text" id="challenge"/><br/>
    <a>Key:</a><input type="file" id="key"/><br/>
    <p>The result of the challenge is: <a id="result"></a></p>
    <script>
        /* Should be generated by backend */
        //document.getElementById("challenge").value = Math.random().toString(36).substring(7);
        
        const fromHexString = hexString =>
          new Uint8Array(hexString.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));

        const toHexString = bytes =>
          bytes.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '');

        /* Our public key */
        let public_system = "1cccdad29902d2e60462184abef36df5f0d260dca16ef67376a2cfcbc190f117"
        //let nonce = nacl.randomBytes(nacl.box.nonceLength);
        let nonce = nacl.randomBytes(24);

        document.getElementById('key') 
            .addEventListener('change', function() { 
            
            let fr=new FileReader();
            fr.onload=function(){
                let private = new Uint8Array(fr.result);

                var enc = new TextEncoder();
                let challenge = enc.encode(document.getElementById("challenge").value);
                console.log(challenge)
                console.log(nonce)
                
                let result = nacl.box(challenge, nonce, fromHexString(public_system), private);
                var display = document.getElementById("result");
                var text = document.createTextNode(toHexString(result));
                display.appendChild(text);
                console.log(result)
            }
            fr.readAsArrayBuffer(this.files[0]); 
        });
    </script>
</body>
</html>