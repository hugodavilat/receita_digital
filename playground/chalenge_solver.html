<!--
Documentation:
- https://github.com/dchest/tweetnacl-js#public-key-authenticated-encryption-box
- https://github.com/dchest/tweetnacl-js/wiki/Examples
-->
<html>
<head>
    <script src="nacl.min.js"></script>
</head>
<body>
    <h1>Challenge Solver</h1>
    <a>Challenge:</a><input type="text" id="challenge"/><br/>
    <a>Key:</a><input type="file" id="key"/><br/>
    <script>
        /* Should be generated by backend */
        document.getElementById("challenge").value = Math.random().toString(36).substring(7);
        
        /* Our public key */
        let public = new Uint8Array([15, 221, 67, 64, 127, 254, 31, 0, 113, 106, 121, 249, 19, 241, 102, 106, 155, 217, 106, 83, 163, 101, 125, 100, 164, 208, 161, 129, 217, 5, 89, 54]);
        let nonce = nacl.randomBytes(nacl.secretbox.nonceLength);

        document.getElementById('key') 
            .addEventListener('change', function() { 
            
            let fr=new FileReader();
            fr.onload=function(){
                let private = new Uint8Array(fr.result);

                var enc = new TextEncoder();
                let challenge = enc.encode(document.getElementById("challenge").value);
                
                let result = nacl.box(challenge, nonce, public, private);
                /* The result below should be send to backend to be checked */
                console.log("The result below should be send to backend to be checked:")
                console.log(result);
            }
            fr.readAsArrayBuffer(this.files[0]); 
        });
    </script>
</body>
</html>